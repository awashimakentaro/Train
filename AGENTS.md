# agents.md

> 本プロジェクトに関わる **すべてのエージェント（AI / 自動化 / 人間）と実装者** が、
> **実装・変更・提案の前に必ず読み、遵守すべき最上位規約**。
>
> Codex CLI・Cursor・ChatGPT 等の **AI エージェント**、および **人間**を問わず、
> 本ファイルを無視した実装・提案は **すべて無効**とする。

---

## 0. 本ドキュメントの位置づけ

### 0.1 優先順位（最重要）

* 本 `agents.md` は、本プロジェクト v1 における **最上位の行動規範・開発規約（憲法）** である。
* 要件定義・設計書・README・実装コード・AIの提案より **常に優先** される。
* 暗黙的・無断での無視・上書き・解釈変更を **一切禁止** する。
* ルールに違和感がある場合は、**実装せず先に本ファイルを更新すること**。

### 0.2 改訂要件（v2 以降）

1. 改訂は **明示的・意図的** でなければならない。
2. 変更理由・影響範囲・旧ルールとの差分を必ず文書化する。
3. 人間の **明示的承認** がない限り、いかなる AI も本ファイルを変更してはならない。

---

## 1. エージェントの定義

* 「エージェント」とは、特定の責務を持ち、自律的に振る舞う **ソフトウェア構成要素** を指す。

  * UI エージェント
  * 状態管理エージェント
  * タイマー・進行制御エージェント
  * Supabase / DB 操作エージェント
  * 解析・変換・補助エージェント など
* **人間はエージェントではない**。
  人間は本規約の制定者・最終判断者である。

---

## 2. 開発・実装ルール（最重要）

本セクションのルールは **全域強制適用** とする。
（フロントエンド / バックエンド / Supabase / SQL / スクリプト / テスト / ドキュメント含む）

### 2.1 ファイル単位のドキュメント化（必須）

* **すべてのファイル先頭**に、以下を日本語で明記すること。

  * ファイルの責務
  * 使用されるエージェント / 処理フロー
  * やらないこと（責務外）
  * 他ファイルとの関係
* 下記ヘッダを欠くファイルは **未完成・未レビュー・実装違反** とみなす。

```ts
/**
 * RecordInputAgent.ts
 *
 * 【責務】
 * 記録タブにおけるユーザー入力（テキスト・画像）を受け取り、
 * 解析エージェントへ受け渡す。
 *
 * 【使用箇所】
 * - RecordScreen から呼び出される。
 *
 * 【やらないこと】
 * - 栄養計算
 * - DB保存
 * - UI描画
 *
 * 【補足】
 * 入力の正規化のみを担当し、判断ロジックは持たない。
 */
```

---

### 2.2 関数・メソッド単位のドキュメント化（必須）

* すべての関数 / メソッドに **日本語ドキュメントコメント**を付与する。
* 必須記述：

  * 処理内容
  * 呼び出し元
  * 入力 / 出力の意味
  * 副作用（状態変更・I/O・DB操作）の有無
* コメント欠如は **即実装違反**。

---

### 2.3 SRP（単一責務原則）の厳守（絶対）

* **1ファイル = 1責務**
* **1クラス = 1役割**
* **1関数 = 1処理**
* 以下を禁止する：

  * 複数責務の混在
  * 条件分岐による役割切替
  * 「ついでに」の処理追加
  * 過度な汎用化
* 迷った場合は **必ず分割** を選択する。

### 2.4 SRP 違反の判断基準

* 名前に複数の動詞的意味が含まれる
* 説明文に「〜しつつ」「場合によって」「ついでに」が出現する
* テスト観点が複数存在する
* 呼び出し元が複数の意図を期待している
  → **即リファクタリング対象**

---

## 3. Figuma / UI 再現ルール（最重要）

### 3.1 figuma フォルダの位置づけ

* `figuma/` 配下のコードは **UI構造・デザイン参照用アセット** である。
* 原則として：

  * 実行禁止
  * import 禁止
  * 直接コピー禁止
* **構造・階層・視線誘導・情報順序の読み取りのみ許可**。

### 3.2 UI 再現度の定義（ピクセル寄せ型）

「再現」とは以下をすべて満たすことを指す：

* コンポーネント階層が一致している
* 情報の並び順が一致している
* 画面遷移数・導線が一致している
* UI の主役（例：タイマー）の視覚的支配力が一致している
* 余白・密度・強弱が **視覚印象として一致** している

※ 完全一致が困難な場合は、**差異を明示して報告**すること。

---

## 4. React Native 実装ルール

* 使用可能要素：

  * View / Text / ScrollView / Pressable 等
* 以下を禁止：

  * div / span / section
  * className / Web CSS
  * Web 前提の position / hover
* スタイルは **リズム重視** とし、px 直訳は禁止。

---

## 5. AI エージェントの裁量範囲

### 5.1 AI が判断してよいこと（質問不要）

* style 数値の微調整（±1段階）
* コンポーネント分割
* ファイル配置
* Supabase の DB 設計・SQL 作成（広裁量）

### 5.2 AI が必ず質問すべきこと

* UI 構造の変更
* 情報順序の変更
* 状態遷移の変更
* 責務の統合・削減
* figuma との差異が生じる判断

---

## 6. 最適化・省略の扱い

* 以下は許可：

  * 重複コード整理
  * import 整理
  * 可読性向上のための分割
* 以下は禁止（要質問）：

  * 処理フロー短縮
  * UI 統合
  * 設計変更を伴う「改善」

---

## 7. 例外・提案ルール

### 7.1 agents.md に反する提案

* 提案自体は可能
* ただし以下を必須とする：

  * 反する条項
  * 変更理由
  * 採用しない場合の影響
* 承認なしの実装は禁止

### 7.2 実験コード

* `experiments/` 等の **明示的例外ゾーン**のみ許可
* 本実装へ流用する場合は **本規約へ完全準拠**

---

## 8. 違反時の扱い

* 違反が見つかった場合：

  * 違反箇所を明示
  * なぜ違反かを説明
  * agents.md に従って **是正再実装**
* 是正完了まで **マージ・採用は禁止**

### 8.1 AI の自己申告義務

* 違反の可能性を検知した場合：

  * 実装は行わない
  * 違反点・代替案を提示
  * 人間の判断を待つ

---

## 9. agents.md 更新ルール

* 改訂案の作成は AI も可能
* ただし：

  * 理由
  * 影響範囲
  * 差分
    を明示
* **人間の明示承認なしに変更禁止**

---

## 10. 価値宣言（思想固定）

本プロジェクトは
**「機能を作るためのコード」ではない。**

これは、

* 自分の思考
* 判断の履歴
* 設計上の葛藤
* 美意識と責任分界

を **未来に保存するための構造体** である。

多少冗長でもよい。
多少遠回りでもよい。

**「なぜこうなっているか」を説明できない最適化は、すべて破壊である。**

AI は補助輪であり、設計者ではない。
このプロジェクトの意思決定主体は、常に **人間** である。

---
